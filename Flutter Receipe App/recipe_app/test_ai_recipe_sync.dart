import 'dart:convert';
import 'package:shared_preferences/shared_preferences.dart';
import 'lib/ai_recipe_generator/domain/entities/ai_meal.dart';

/// Test script Ä‘á»ƒ thÃªm sample AI recipe vÃ  test sync function
void main() async {
  print('ğŸ§ª Testing AI Recipe Sync...');

  // ThÃªm sample AI recipe vÃ o local storage
  await addSampleAIRecipe();

  print('âœ… Sample AI recipe added to local storage');
  print('ğŸ“± Open the Flutter app and check if sync works!');
}

/// ThÃªm má»™t sample AI recipe vÃ o SharedPreferences
Future<void> addSampleAIRecipe() async {
  final prefs = await SharedPreferences.getInstance();

  // Táº¡o sample AI recipe
  final sampleRecipe = AIMeal(
    id: 'test_ai_recipe_${DateTime.now().millisecondsSinceEpoch}',
    title: 'AI Generated Chocolate Cake',
    description:
        'Delicious chocolate cake generated by AI assistant. Perfect for dessert lovers with rich cocoa flavor and moist texture.',
    ingredients: [
      '2 cups all-purpose flour',
      '3/4 cup unsweetened cocoa powder',
      '2 cups granulated sugar',
      '2 teaspoons baking soda',
      '1 teaspoon baking powder',
      '1 teaspoon salt',
      '2 large eggs',
      '1 cup buttermilk',
      '1 cup strong black coffee, cooled',
      '1/2 cup vegetable oil',
      '1 teaspoon vanilla extract'
    ],
    instructions: [
      'Preheat oven to 350Â°F (175Â°C). Grease and flour two 9-inch round cake pans.',
      'In a large bowl, whisk together flour, cocoa powder, sugar, baking soda, baking powder, and salt.',
      'In another bowl, beat eggs, then stir in buttermilk, coffee, oil, and vanilla.',
      'Pour wet ingredients into dry ingredients and mix until well combined.',
      'Divide batter evenly between prepared pans.',
      'Bake for 30-35 minutes or until a toothpick inserted in center comes out clean.',
      'Cool in pans for 10 minutes, then turn out onto wire racks to cool completely.',
      'Frost with your favorite chocolate frosting when completely cool.'
    ],
    cuisine: 'Dessert',
    preparationTime: 20,
    cookingTime: 45,
    servings: 12,
    estimatedCalories: 320.0,
    difficulty: 'Medium',
    tags: ['dessert', 'chocolate', 'cake', 'ai-generated'],
    imageUrl: 'https://via.placeholder.com/400x300?text=AI+Chocolate+Cake',
    createdAt: DateTime.now(),
  );

  // Láº¥y danh sÃ¡ch recipes hiá»‡n táº¡i (náº¿u cÃ³)
  final recipesJson = prefs.getString('ai_recipes');
  List<Map<String, dynamic>> recipesList = [];

  if (recipesJson != null) {
    final List<dynamic> existingRecipes = json.decode(recipesJson);
    recipesList = existingRecipes.cast<Map<String, dynamic>>();
  }

  // ThÃªm recipe má»›i
  recipesList.add(sampleRecipe.toJson());

  // LÆ°u láº¡i vÃ o SharedPreferences
  await prefs.setString('ai_recipes', json.encode(recipesList));

  print('ğŸ“ Sample recipe added:');
  print('   Title: ${sampleRecipe.title}');
  print('   Ingredients: ${sampleRecipe.ingredients.length} items');
  print('   Instructions: ${sampleRecipe.instructions.length} steps');
  print('   Ready for sync to admin panel!');
}
